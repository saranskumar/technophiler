<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>Technophiler - Chatbot</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <style>
    /* Chat container styling */
    #chat-container {
      height: 60vh;
      overflow-y: auto;
      padding: 15px;
      margin-bottom: 15px;
      background: #1a1a1a;
      border-radius: 8px;
    }
    
    /* Clear button styling - consistent across devices */
    #clear-button {
      margin-bottom: 15px;
      transition: all 0.3s ease;
      border-color: #dc3545;
      color: #dc3545;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    #clear-button:hover {
      background-color: #dc3545;
      color: white;
    }
    
    /* Input area styling */
    .inputs {
      display: flex;
      gap: 10px;
    }
    
    #message-input {
      flex-grow: 1;
      padding: 10px 15px;
      border-radius: 20px;
      border: none;
      background: #2d2d2d;
      color: white;
    }
    
    #send-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: #4a6fa5;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    /* Mobile full-screen adaptations */
    @media (max-width: 768px) {
      #ai {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 15px;
        margin: 0;
        background: #1a1a1a;
        z-index: 1000;
        display: flex;
        flex-direction: column;
      }
      
      #header {
        display: none;
      }
      
      #chat-container {
        height: calc(100vh - 150px) !important;
        margin-bottom: 10px;
        flex-grow: 1;
      }
      
      .inputs {
        padding: 5px;
      }
      
      /* Mobile close button */
      .mobile-close-chat {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 1001;
        background: rgba(220, 53, 69, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      /* Adjust clear button for mobile */
      #clear-button {
        padding: 5px 10px;
        font-size: 0.8rem;
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 1001;
      }
      
      #clear-button .clear-text {
        display: none;
      }
    }
  </style>

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="container">
      <h1> tech<a href="https://trex-runner.com/" target="_blank">no</a>philer</h1>
     
      <nav id="navbar" class="navbar">
         <ul>
          <li><a class="nav-link active" href="/index.html">Home</a></li>
          <li><a class="nav-link" href="/about.html">About</a></li>
          <li><a class="nav-link" href="/gallery.html">Gallery</a></li>
          <li><a class="nav-link" href="/services.html">Projects</a></li>
          <li><a class="nav-link" href="/contact.html">Contact</a></li>
        </ul>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->
 
  <!-- ======= Services Section ======= -->
         <section id="ai" class="ai"> 
            <div id="chat-container"></div>
             <div class="inputs">
                 <input type="text" id="message-input" placeholder="Type your message...">
                  <button id="send-button">âž¤</button>
             </div>
  </section><!-- End Services Section -->
  

  <!-- Vendor JS Files -->
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  
  
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Immediately show the contact section (override main.js behavior)
    const contactSection = document.getElementById('ai');
    if (contactSection) {
      contactSection.classList.add('section-show');
    }

    // Set the contact link as active
    const navLinks = document.querySelectorAll('#navbar .nav-link');
    navLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === '#ai' || 
          link.getAttribute('href').endsWith('ai.html')) {
        link.classList.add('active');
      }

    // Modify the navbar click handler specifically for the contact page
    const navbar = document.getElementById('navbar');
    if (navbar) {
      navbar.addEventListener('click', function(e) {
        const navLink = e.target.closest('.nav-link');
        if (navLink) {
          // If clicking on Contact link while already on contact page
          if (navLink.getAttribute('href') === '#ai' || 
              navLink.getAttribute('href').endsWith('ai.html')) {
            e.preventDefault();
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          }
          // For mobile, close the navbar after click
          if (navbar.classList.contains('navbar-mobile')) {
            navbar.classList.remove('navbar-mobile');
            const navbarToggle = document.querySelector('.mobile-nav-toggle');
            if (navbarToggle) {
              navbarToggle.classList.toggle('bi-list');
              navbarToggle.classList.toggle('bi-x');
            }
          }
        }
      });
    }

    // Ensure header is in the correct state
    const header = document.getElementById('header');
    if (header) {
      header.classList.add('header-top');
    }
  }); 
}); 
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Immediately show the contact section (override main.js behavior)
  // Add mobile close button (optional)
if (window.innerWidth <= 768) {
  const closeButton = document.createElement('button');
  closeButton.className = 'mobile-close-chat';
  closeButton.innerHTML = '<i class="bi bi-x-lg"></i>';
  closeButton.onclick = () => window.history.back();
  document.body.appendChild(closeButton);
}

// Handle mobile view changes
function handleMobileView() {
  if (window.innerWidth <= 768) {
    document.body.style.overflow = 'hidden';
    document.getElementById('header').style.display = 'none';
  } else {
    document.body.style.overflow = '';
    document.getElementById('header').style.display = '';
    const closeBtn = document.querySelector('.mobile-close-chat');
    if (closeBtn) closeBtn.remove();
  }
}

// Initial check
handleMobileView();

// Handle window resize
window.addEventListener('resize', handleMobileView);
  const contactSection = document.getElementById('ai');
  if (contactSection) {
    contactSection.classList.add('section-show');
  }

  // Set the contact link as active
  const navLinks = document.querySelectorAll('#navbar .nav-link');
  navLinks.forEach(link => {
    link.classList.remove('active');
    if (link.getAttribute('href') === '#ai' || 
        link.getAttribute('href').endsWith('ai.html')) {
      link.classList.add('active');
    }
  });

  // Modify the navbar click handler specifically for the contact page
  const navbar = document.getElementById('navbar');
  if (navbar) {
    navbar.addEventListener('click', function(e) {
      const navLink = e.target.closest('.nav-link');
      if (navLink) {
        // If clicking on Contact link while already on contact page
        if (navLink.getAttribute('href') === '#ai' || 
            navLink.getAttribute('href').endsWith('ai.html')) {
          e.preventDefault();
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        }
        // For mobile, close the navbar after click
        if (navbar.classList.contains('navbar-mobile')) {
          navbar.classList.remove('navbar-mobile');
          const navbarToggle = document.querySelector('.mobile-nav-toggle');
          if (navbarToggle) {
            navbarToggle.classList.toggle('bi-list');
            navbarToggle.classList.toggle('bi-x');
          }
        }
      }
    });
  }

  // Ensure header is in the correct state
  const header = document.getElementById('header');
  if (header) {
    header.classList.add('header-top');
  }

  // Chat functionality
  const chatContainer = document.getElementById('chat-container');
  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-button');
  
 // Modify your existing clear button creation code to:
  const clearButton = document.createElement('button');
 clearButton.id = 'clear-button';
 clearButton.innerHTML = '<i class="bi bi-trash"></i> <span class="clear-text">Clear Chat</span>';
 clearButton.classList.add('btn', 'btn-outline-danger', 'btn-sm', 'd-flex', 'align-items-center', 'gap-2', 'mobile-clear-btn');

  // Insert clear button before input area
  const inputsContainer = document.querySelector('.inputs');
  inputsContainer.parentNode.insertBefore(clearButton, inputsContainer);

  // Enhanced message styling
  function addMessage(message, sender) {
    const messageElement = document.createElement('div');
    messageElement.classList.add('d-flex', 'mb-3');
    
    const bubble = document.createElement('div');
    bubble.classList.add(
      'p-3', 
      'rounded-4',
      'shadow-sm',
      ...(sender === 'user' ? ['user-message'] : ['ai-message'])
    );
    bubble.style.maxWidth = '80%';
    bubble.style.wordBreak = 'break-word';
    
    // Add robot icon for AI messages
    if (sender === 'ai') {
      const icon = document.createElement('i');
      icon.classList.add('bi', 'bi-robot', 'me-2');
      bubble.prepend(icon);
    }
    
    // Format message content (only for AI messages)
    if (sender === 'ai') {
      bubble.innerHTML = formatMessage(message);
    } else {
      bubble.textContent = message;
    }
    
    messageElement.appendChild(bubble);
    chatContainer.appendChild(messageElement);
    
    // Smooth scroll to bottom
    chatContainer.scrollTo({
      top: chatContainer.scrollHeight,
      behavior: 'smooth'
    });
  }

  // Format AI messages
  function formatMessage(text) {
    return text
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/_(.*?)_/g, '<u>$1</u>')
      .replace(/```(.*?)```/gs, '<pre><code>$1</code></pre>')
      .replace(/`(.*?)`/g, '<code>$1</code>')
      .replace(/\n\*\s(.*?)(?=\n|$)/g, '<li>$1</li>')
      .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
      .replace(/\n/g, '<br>');
  }

  // Loading indicator
  function addLoadingMessage() {
    const loadingElement = document.createElement('div');
    loadingElement.classList.add('d-flex', 'mb-3');
    
    const loadingBubble = document.createElement('div');
    loadingBubble.classList.add('p-3', 'rounded-4', 'ai-message');
    loadingBubble.style.maxWidth = '80%';
    
    const spinner = document.createElement('div');
    spinner.classList.add('spinner-border', 'spinner-border-sm', 'text-secondary', 'me-2');
    spinner.setAttribute('role', 'status');
    
    const text = document.createElement('span');
    text.textContent = 'AI is thinking...';
    
    loadingBubble.appendChild(spinner);
    loadingBubble.appendChild(text);
    loadingElement.appendChild(loadingBubble);
    loadingElement.id = 'loading-message';
    chatContainer.appendChild(loadingElement);
    
    chatContainer.scrollTo({
      top: chatContainer.scrollHeight,
      behavior: 'smooth'
    });
    
    return loadingElement;
  }

  // Save chat history
  function saveChatToLocalStorage() {
    const messages = Array.from(chatContainer.querySelectorAll('.d-flex'))
      .filter(el => el.id !== 'loading-message')
      .map(el => ({
        text: el.textContent.replace('AI is thinking...', '').trim(),
        sender: el.querySelector('.user-message') ? 'user' : 'ai',
        time: new Date().toISOString()
      }));
    localStorage.setItem('chatHistory', JSON.stringify(messages));
  }

  // Load chat history
  function loadChatFromLocalStorage() {
    const savedMessages = JSON.parse(localStorage.getItem('chatHistory'));
    if (savedMessages?.length > 0) {
      savedMessages.forEach(msg => addMessage(msg.text, msg.sender));
    } else {
      addMessage("Hello! I'm your AI assistant. How can I help you today?", 'ai');
    }
  }

  // Send message function
  async function sendMessage() {
    const userMessage = messageInput.value.trim();
    if (!userMessage) return;

    addMessage(userMessage, 'user');
    messageInput.value = '';
    sendButton.disabled = true;
    messageInput.disabled = true;

    const loadingElement = addLoadingMessage();

    try {
      const response = await fetch('/.netlify/functions/gemini-proxy', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({ 
          message: userMessage,
          chatHistory: getCurrentChatHistory()
        })
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      loadingElement.remove();
      const aiMessage = data.response || "I didn't get a response.";
      addMessage(aiMessage, 'ai');
      saveChatToLocalStorage();
      
    } catch (error) {
      console.error('Error:', error);
      loadingElement.remove();
      addMessage(`Error: ${error.message || 'Failed to process request'}`, 'ai');
    } finally {
      sendButton.disabled = false;
      messageInput.disabled = false;
      messageInput.focus();
    }
  }

  // Get chat history from DOM
  function getCurrentChatHistory() {
    return Array.from(chatContainer.querySelectorAll('.d-flex'))
      .filter(el => el.id !== 'loading-message')
      .filter((el, index) => !(index === 0 && !el.querySelector('.user-message')))
      .map(el => ({
        sender: el.querySelector('.user-message') ? 'user' : 'ai',
        text: el.textContent.replace('AI is thinking...', '').trim()
      }));
  }

  // Clear chat function
  function clearChat() {
    if (chatContainer.children.length > 0 && confirm('Clear all chat history?')) {
      chatContainer.innerHTML = '';
      localStorage.removeItem('chatHistory');
      addMessage("Chat cleared. How can I help you now?", 'ai');
    }
  }

  // Event listeners
  sendButton.addEventListener('click', sendMessage);
  clearButton.addEventListener('click', clearChat);
  
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
  
  messageInput.addEventListener('input', () => {
    sendButton.disabled = messageInput.value.trim() === '';
  });

  // Initialize chat
  loadChatFromLocalStorage();
  messageInput.focus();
});
</script>

<style>
  /* Clear button styles */
  #clear-button {
    margin-bottom: 15px;
    transition: all 0.3s ease;
    border-color: #dc3545;
    color: #dc3545;
  }
  
  #clear-button:hover {
    background-color: #dc3545;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
  }
  
  #clear-button i {
    font-size: 0.9rem;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    #clear-button {
      width: 100%;
      justify-content: center;
    }
  }
</style>


</body>
</html>