<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <title>Technophiler - Chatbot</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="container">
      <h1> tech<a href="https://trex-runner.com/" target="_blank">no</a>philer</h1>
     
      <nav id="navbar" class="navbar">
         <ul>
          <li><a class="nav-link active" href="/index.html">Home</a></li>
          <li><a class="nav-link" href="/about.html">About</a></li>
          <li><a class="nav-link" href="/gallery.html">Gallery</a></li>
          <li><a class="nav-link" href="/services.html">Projects</a></li>
          <li><a class="nav-link" href="/contact.html">Contact</a></li>
        </ul>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->
 
  <!-- ======= Services Section ======= -->
         <section id="ai" class="ai"> 
            <div id="chat-container"></div>
             <div class="inputs">
                 <input type="text" id="message-input" placeholder="Type your message...">
                  <button id="send-button">âž¤</button>
             </div>
  </section><!-- End Services Section -->
  

  <!-- Vendor JS Files -->
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  
  
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Immediately show the contact section (override main.js behavior)
    const contactSection = document.getElementById('ai');
    if (contactSection) {
      contactSection.classList.add('section-show');
    }

    // Set the contact link as active
    const navLinks = document.querySelectorAll('#navbar .nav-link');
    navLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === '#ai' || 
          link.getAttribute('href').endsWith('ai.html')) {
        link.classList.add('active');
      }

    // Modify the navbar click handler specifically for the contact page
    const navbar = document.getElementById('navbar');
    if (navbar) {
      navbar.addEventListener('click', function(e) {
        const navLink = e.target.closest('.nav-link');
        if (navLink) {
          // If clicking on Contact link while already on contact page
          if (navLink.getAttribute('href') === '#ai' || 
              navLink.getAttribute('href').endsWith('ai.html')) {
            e.preventDefault();
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          }
          // For mobile, close the navbar after click
          if (navbar.classList.contains('navbar-mobile')) {
            navbar.classList.remove('navbar-mobile');
            const navbarToggle = document.querySelector('.mobile-nav-toggle');
            if (navbarToggle) {
              navbarToggle.classList.toggle('bi-list');
              navbarToggle.classList.toggle('bi-x');
            }
          }
        }
      });
    }

    // Ensure header is in the correct state
    const header = document.getElementById('header');
    if (header) {
      header.classList.add('header-top');
    }
  }); 
}); 
</script>

<script type="module">
  const chatContainer = document.getElementById('chat-container');
  const messageInput = document.getElementById('message-input');
  const sendButton = document.getElementById('send-button');
  
  // Create clear button if it doesn't exist
  let clearButton = document.getElementById('clear-button');
  if (!clearButton) {
    clearButton = document.createElement('button');
    clearButton.id = 'clear-button';
    clearButton.textContent = 'Clear Chat';
    clearButton.classList.add('btn', 'btn-secondary', 'mt-2', 'ms-2');
    document.querySelector('.inputs').appendChild(clearButton);
  }

  // Enhanced message styling
  function addMessage(message, sender) {
    const messageElement = document.createElement('div');
    messageElement.classList.add('d-flex', 'mb-3');
    
    const bubble = document.createElement('div');
    bubble.classList.add(
      'p-3', 
      'rounded-4',
      'shadow-sm',
      sender === 'user' ? 'bg-primary text-white ms-auto' : 'bg-light me-auto'
    );
    bubble.style.maxWidth = '80%';
    bubble.style.wordBreak = 'break-word';
    
    // Add robot icon for AI messages
    if (sender === 'ai') {
      const icon = document.createElement('i');
      icon.classList.add('bi', 'bi-robot', 'me-2');
      bubble.prepend(icon);
    }
    
    bubble.textContent = message;
    messageElement.appendChild(bubble);
    chatContainer.appendChild(messageElement);
    
    // Smooth scroll to bottom
    chatContainer.scrollTo({
      top: chatContainer.scrollHeight,
      behavior: 'smooth'
    });
  }

  // Enhanced loading indicator
  function addLoadingMessage() {
    const loadingElement = document.createElement('div');
    loadingElement.classList.add('d-flex', 'mb-3');
    
    const loadingBubble = document.createElement('div');
    loadingBubble.classList.add('p-3', 'rounded-4', 'bg-light', 'me-auto');
    loadingBubble.style.maxWidth = '80%';
    
    const spinner = document.createElement('div');
    spinner.classList.add('spinner-border', 'spinner-border-sm', 'text-secondary', 'me-2');
    spinner.setAttribute('role', 'status');
    
    const text = document.createElement('span');
    text.textContent = 'AI is thinking...';
    
    loadingBubble.appendChild(spinner);
    loadingBubble.appendChild(text);
    loadingElement.appendChild(loadingBubble);
    loadingElement.id = 'loading-message';
    chatContainer.appendChild(loadingElement);
    
    chatContainer.scrollTo({
      top: chatContainer.scrollHeight,
      behavior: 'smooth'
    });
    
    return loadingElement;
  }

  // Save chat with timestamps
  function saveChatToLocalStorage() {
    const messages = Array.from(chatContainer.querySelectorAll('.d-flex'))
      .filter(el => el.id !== 'loading-message')
      .map(el => ({
        text: el.textContent.replace('AI is thinking...', '').trim(),
        sender: el.querySelector('.bg-primary') ? 'user' : 'ai',
        time: new Date().toISOString()
      }));
    localStorage.setItem('chatHistory', JSON.stringify(messages));
  }

  // Load chat with welcome message if empty
  function loadChatFromLocalStorage() {
    const savedMessages = JSON.parse(localStorage.getItem('chatHistory'));
    if (savedMessages?.length > 0) {
      savedMessages.forEach(msg => addMessage(msg.text, msg.sender));
    } else {
      addMessage("Hello! I'm your AI assistant. How can I help you today?", 'ai');
    }
  }

  // Enhanced send function with better error handling
  async function sendMessage() {
    const userMessage = messageInput.value.trim();
    if (!userMessage) return;

    // Add user message and clear input
    addMessage(userMessage, 'user');
    messageInput.value = '';
    sendButton.disabled = true;
    messageInput.disabled = true;

    const loadingElement = addLoadingMessage();

    try {
      console.log('Sending message to function');
      const response = await fetch('/.netlify/functions/gemini-proxy', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: userMessage })
      });

      const data = await response.json();
      console.log('Response data:', data);

      if (!response.ok) {
        throw new Error(data.error || 'Request failed');
      }

      loadingElement.remove();
      const aiMessage = data.response || data.text || "I didn't get a response.";
      addMessage(aiMessage, 'ai');
      saveChatToLocalStorage();
      
    } catch (error) {
      console.error('Error:', error);
      loadingElement.remove();
      addMessage(`Error: ${error.message || 'Failed to process request'}`, 'ai');
    } finally {
      sendButton.disabled = false;
      messageInput.disabled = false;
      messageInput.focus();
    }
  }

  // Clear chat with confirmation
  function clearChat() {
    if (chatContainer.children.length > 0 && confirm('Clear all chat history?')) {
      chatContainer.innerHTML = '';
      localStorage.removeItem('chatHistory');
      addMessage("Chat cleared. How can I help you now?", 'ai');
    }
  }

  // Event listeners with better UX
  sendButton.addEventListener('click', sendMessage);
  
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  clearButton.addEventListener('click', clearChat);
  
  // Input validation
  messageInput.addEventListener('input', () => {
    sendButton.disabled = messageInput.value.trim() === '';
  });

  // Initialize chat
  document.addEventListener('DOMContentLoaded', () => {
    loadChatFromLocalStorage();
    messageInput.focus();
  });
</script>
 
</body>
</html>